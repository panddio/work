#include <stdio.h>#include <stdlib.h>#include <string.h>#include "sqlite3.h"void execute(sqlite3 *db,char *sql_cmd){	char *errmsg = NULL;		int ret = sqlite3_exec(db, sql_cmd, NULL, NULL, &errmsg);	if(ret != SQLITE_OK)	{		printf("errmsg2 =%s\n", errmsg);		return ;	}		return;}void create_table(sqlite3 *db)  //创建表{	char sql_cmd[1024] = "";	strcpy(sql_cmd, "create table persons(id int, name varchar(40), addr text);");	execute(db, sql_cmd);	printf("创建成功\n");		return ;}void print(sqlite3 *db) //查询数据库所有数据{	char **result = NULL;	char *errmsg = NULL;	int nrow = 0;	int col = 0;		const char *sql = "select * from persons;";	int ret = sqlite3_get_table(db, sql, &result, &nrow, &col, &errmsg);	if(ret != SQLITE_OK)	{		printf("errmsg3 =%s\n", errmsg);		return ;	}		int i,j;	for(i=0;i<(nrow+1);i++)	{		for(j=0;j<col;j++)		{			printf("%s:", result[i*col + j]);		}	}		sqlite3_free_table(result);		return ;}void insert(sqlite3 *db) //插入数据{	char sql_cmd[1024] = "";	int id = 0;	unsigned char name[40] = "";	unsigned char addr[64] = "";			printf("请输入id,name,addr:\n");	scanf("%d %s %s",&id,name,addr);	sprintf(sql_cmd, "insert into persons values (%d, '%s', '%s');", id, name, addr);	execute(db, sql_cmd);		return;}int main(int argc, char **argv){	char *data = NULL;	int op = 0;		// 获取在浏览器端以GET方法输入的数据	// 之前是这样做的，url="/cgi-bin/_cgi2.cgi?1+2"， open("GET",url,true)，	// 获取的内容为 "?" 后面的内容，即为 data = "1+2";	data = getenv("QUERY_STRING");	if(NULL == data)	{		printf("error");		return 0;	}	printf("content-type:text/html\n\n");		sscanf(data, "%d", &op);		//打开数据库	char *name = "work.db";	sqlite3 *db = NULL;	int ret = sqlite3_open(name, &db);	if(ret != SQLITE_OK)		return 0;				if(1 == op) //创建表	{		create_table(db);	}	else if(2 == op) //插入	{		insert(db);	}	else if(3 == op) //查询	{		print(db);	}	else if(4 == op) //退出	{		sqlite3_close(db);		return 0;	}		return 0;}